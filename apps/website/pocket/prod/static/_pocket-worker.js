"use strict";(()=>{var O=Object.create,L=Object.freeze,w=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var oe=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ne=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),M=(t,e)=>{for(var o in e)w(t,o,{get:e[o],enumerable:!0})},se=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of te(e))!re.call(t,n)&&n!==o&&w(t,n,{get:()=>e[n],enumerable:!(r=ee(e,n))||r.enumerable});return t};var ie=(t,e,o)=>(o=t!=null?O(oe(t)):{},se(e||!t||!t.__esModule?w(o,"default",{value:t,enumerable:!0}):o,t));var y=(t,e)=>L(w(t,"raw",{value:L(e||t.slice())}));var $=ne((Ae,j)=>{"use strict";var ue=/["'&<>]/;j.exports=le;function le(t){var e=""+t,o=ue.exec(e);if(!o)return e;var r,n="",s=0,i=0;for(s=o.index;s<e.length;s++){switch(e.charCodeAt(s)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#39;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}i!==s&&(n+=e.substring(i,s)),i=s+1,n+=r}return i!==s?n+e.substring(i,s):n}});function ae(t){var e;return(e=t==null?void 0:t.split(";").map(o=>{let r=o.indexOf("=");return{name:o.slice(0,r).trim(),value:decodeURIComponent(o.slice(r+1).trim())}}))!==null&&e!==void 0?e:[]}function ce(t){let e=`${t.name}=${encodeURIComponent(t.value)}`;return t.path&&(e+=`;Path=${t.path}`),t.expires&&(e+=`;Expires=${t.expires.toUTCString()}`),t.maxAge&&(e+=`;MaxAge=${t.maxAge}`),t.sameSite?e+=`;SameSite=${t.sameSite===!0?"Strict":t.sameSite}`:e+=";SameSite=Lax",t.secure&&(e+=";Secure"),t.httpOnly&&(e+=";HttpOnly"),e}var x=class{constructor(e){this.cookies=new Map(e.map(o=>[o.name,o]))}get size(){return this.cookies.size}get(e){return this.cookies.get(e)}getAll(e){if(e){let o=this.cookies.get(e);return o?[o]:[]}return Array.from(this.cookies.values())}has(e){return this.cookies.has(e)}set(e,o){return this.cookies.set(e,{name:e,value:o}),this}delete(e){return Array.isArray(e)?e.map(o=>this.cookies.delete(o)):this.cookies.delete(e)}clear(){return this.cookies.clear(),this}toString(){return Array.from(this.cookies.values()).map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join(";")}},k=class{constructor(e,o){this.cookies=ae(e.get("Set-Cookie")).map(r=>({path:"/",...r})),o&&this.cookies.push(...o)}get(e){return this.cookies.reverse().find(o=>o.name===e)}getAll(e){if(e){let r=this.get(e);return r?[r]:[]}let o=new Map;for(let r of this.cookies)o.set(r.name,r);return Array.from(o.values())}set(e,o,r){return typeof e=="object"?(this.cookies.push(e),this):(this.cookies.push({...r,name:e,value:o}),this)}delete(e,o){return this.cookies.push({name:e,value:"",maxAge:0,...o}),this}toString(){return this.getAll().map(ce).join(",")}};var v=class extends Request{constructor(e,o){super(e),this.cookies=o}};var W=ie($(),1);function l(t,...e){return new u(t,e)}l.raw=function(e){return new u([e],[])};l.wrap=function(e){return{html(o,...r){return e(new u(o,r))}}};var Be=l.wrap,u=class{constructor(e,o){if(this.strings=e,this.args=o,e.length===o.length)this.strings=[...e,""];else if(e.length!==o.length+1)throw new Error("strings.length must be args.length + 1")}renderToStream(){let e=[...this.strings],o=[...this.args],r=new TextEncoder;return new ReadableStream({async start(n){for(;e.length>0;){let s=e.shift(),i=o.shift();s&&n.enqueue(r.encode(s));let f=Array.isArray(i)?i:[i];for(let c of f){let a=await c;if(a){if(typeof a=="string"){n.enqueue(r.encode((0,W.default)(a)));continue}if(typeof a=="number"){n.enqueue(r.encode(a.toString()));continue}if("then"in a){e.unshift(""),o.unshift(await a);continue}if(a instanceof u){e.unshift(...a.strings),o.unshift(...a.args,"");continue}throw console.error("wrong arg",c,u),new TypeError("Argument is not of any allowed type")}}}n.close()}})}async renderToString(){let e=this.renderToStream(),o=new TextDecoder,r=e.getReader(),n=[];for(;;){console.log("read next value");let{done:s,value:i}=await r.read();if(console.log("read value"),s)return n.join("");n.push(o.decode(i))}}static from(e){return e instanceof u?e:new u([""],[e])}static join(...e){let o=[],r=[];for(let n of e)for(o.push(...n.strings),r.push(...n.args);o.length>r.length;)r.push("");return new u(o,r)}},F,fe=l(F||(F=y([`
  <script
    defer
    src="/_pocket/runtime.js"
    id="pocket-runtime"
    data-env="`,`"
  ><\/script>
`])),"worker");var h=class extends Response{constructor(e,o){super(e instanceof u?e.renderToStream():e,o);let r=(o==null?void 0:o.headers)instanceof Headers?o.headers:new Headers(o==null?void 0:o.headers);if(this.cookies=new k(r),o!=null&&o.cookies)for(let n of o.cookies)this.cookies.set(n);e instanceof u&&this.headers.set("Conent-Type","text/html")}};var H;function q(t){let e=l(H||(H=y([`
    <script
      defer
      src="/_pocket/runtime.js"
      id="pocket-runtime"
      data-env="`,`"
    ><\/script>
  `])),"worker");return t.css?l`
      ${e}
      <link rel="stylesheet" href="${t.css}" />
    `:e}function D(t={}){return new Response("404 Not Found",{status:404,statusText:"Not Found",...t})}async function V({methods:t,layouts:e,css:o},r){console.log("handleRoute");let n=t[r.method.toLowerCase()];if(!n&&!t.body)return D();let s;if(t.body){let f=function(c){let a=u.from(t.body({req:r,props:c})),p=[];t.head&&p.push(u.from(t.head({req:r,props:c})));for(let g of e)g.layout.head&&p.unshift(u.from(g.layout.head({req:r}))),g.layout.body&&(a=u.from(g.layout.body({req:r,children:a})));return new u(["<!DOCTYPE html><html><head>","","</head><body>","</body></html>"],[p,q({css:o}),a])};var i=f;n?s=await n({req:r,render:f}):s=new h(f(void 0)),s instanceof Response||(s=new h(s))}else if(n)console.log("api handler"),s=await n({req:r});else return console.log("not found"),D();return s instanceof Response||(s=new h(s)),s}var de=(t,e)=>e.some(o=>t instanceof o),_,U;function he(){return _||(_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pe(){return U||(U=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var K=new WeakMap,C=new WeakMap,N=new WeakMap,I=new WeakMap,A=new WeakMap;function me(t){let e=new Promise((o,r)=>{let n=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{o(d(t.result)),n()},i=()=>{r(t.error),n()};t.addEventListener("success",s),t.addEventListener("error",i)});return e.then(o=>{o instanceof IDBCursor&&K.set(o,t)}).catch(()=>{}),A.set(e,t),e}function ge(t){if(C.has(t))return;let e=new Promise((o,r)=>{let n=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{o(),n()},i=()=>{r(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)});C.set(t,e)}var E={get(t,e,o){if(t instanceof IDBTransaction){if(e==="done")return C.get(t);if(e==="objectStoreNames")return t.objectStoreNames||N.get(t);if(e==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return d(t[e])},set(t,e,o){return t[e]=o,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function z(t){E=t(E)}function we(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...o){let r=t.call(b(this),e,...o);return N.set(r,e.sort?e.sort():[e]),d(r)}:pe().includes(t)?function(...e){return t.apply(b(this),e),d(K.get(this))}:function(...e){return d(t.apply(b(this),e))}}function ye(t){return typeof t=="function"?we(t):(t instanceof IDBTransaction&&ge(t),de(t,he())?new Proxy(t,E):t)}function d(t){if(t instanceof IDBRequest)return me(t);if(I.has(t))return I.get(t);let e=ye(t);return e!==t&&(I.set(t,e),A.set(e,t)),e}var b=t=>A.get(t);function Y(t,e,{blocked:o,upgrade:r,blocking:n,terminated:s}={}){let i=indexedDB.open(t,e),f=d(i);return r&&i.addEventListener("upgradeneeded",c=>{r(d(i.result),c.oldVersion,c.newVersion,d(i.transaction),c)}),o&&i.addEventListener("blocked",c=>o(c.oldVersion,c.newVersion,c)),f.then(c=>{s&&c.addEventListener("close",()=>s()),n&&c.addEventListener("versionchange",a=>n(a.oldVersion,a.newVersion,a))}).catch(()=>{}),f}var xe=["get","getKey","getAll","getAllKeys","count"],ke=["put","add","delete","clear"],B=new Map;function X(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(B.get(e))return B.get(e);let o=e.replace(/FromIndex$/,""),r=e!==o,n=ke.includes(o);if(!(o in(r?IDBIndex:IDBObjectStore).prototype)||!(n||xe.includes(o)))return;let s=async function(i,...f){let c=this.transaction(i,n?"readwrite":"readonly"),a=c.store;return r&&(a=a.index(f.shift())),(await Promise.all([a[o](...f),n&&c.done]))[0]};return B.set(e,s),s}z(t=>({...t,get:(e,o,r)=>X(e,o)||t.get(e,o,r),has:(e,o)=>!!X(e,o)||t.has(e,o)}));var m=null;async function R(){return m=m!=null?m:await Y("_pocket",2,{upgrade(t){console.log("upgrade"),t.createObjectStore("cookies",{keyPath:"name"}),t.createObjectStore("data"),console.log("upgrade done")}}),m}async function G(){return(await(await R()).getAll("cookies")).filter(o=>!o.name.startsWith("_pocket"))}async function J(t){if(console.log("set",t),t.length===0)return;let e=await R();console.log("set cookies",t);let o=e.transaction("cookies","readwrite");for(let r of t)await o.store.put(r);await o.store.put({name:"_pocket_ts",value:Math.floor(Date.now()/1e3).toString(),path:"/",maxAge:3456e4}),o.commit()}async function Q(t){console.log(t);async function e(o){let r=new URL(o.request.url);if(r.hostname!==location.hostname)return fetch(o.request);for(let n of t){if(console.log("match",n.path,r.pathname),r.pathname!==n.path)continue;let s=await G(),i=new v(o.request,new x(s)),f=await V(n,i);f.headers.set("Server","Pocket Worker");let c=f instanceof h?f.cookies.getAll():null;return console.log("response cookie",c),c&&o.waitUntil((async()=>{await J(c);let a=await clients.get(o.clientId);console.log({client:a});let p={type:"sync-cookies"};a?.postMessage(p)})()),console.log("retrrn",f.headers,o),f}return console.log("fetch fallback",o.request.url),fetch(o.request)}addEventListener("fetch",o=>{let r=o;console.log("fetchevent",r.request.method,r.request.url),r.respondWith(e(r))})}var T={};M(T,{body:()=>be});var S=l.wrap(t=>l`<div class="w-full max-w-7xl mx-auto px-4">${t}</div>`);function be(){return l`<section class="py-8">${S.html`Hello World`}</section>`}var P={};M(P,{body:()=>De,head:()=>Se});function Z(){return l`
    <nav class="bg-orange-600 relative py-4">
      ${S.html`
        <div class="flex flex-row justify-between">
          <ul>
            <li><a href="/">Home</a></li>
          </ul>
          <div>Pocket</div>
        </div>
      `}
    </nav>
  `}function Se(){return l`
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pocket Framework</title>
  `}function De({children:t}){return l` ${Z()} ${t} `}Q([{path:"/",methods:T,css:"/_pocket/client/index.css",client:null,layouts:[{path:"/",layout:P,pathDigest:"0cc7d9"}]}]);})();
/*! Bundled license information:

escape-html/index.js:
  (*!
   * escape-html
   * Copyright(c) 2012-2013 TJ Holowaychuk
   * Copyright(c) 2015 Andreas Lubbe
   * Copyright(c) 2015 Tiancheng "Timothy" Gu
   * MIT Licensed
   *)
*/
